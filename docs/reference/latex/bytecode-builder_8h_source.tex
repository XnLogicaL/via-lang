\doxysection{bytecode-\/builder.h}
\hypertarget{bytecode-builder_8h_source}{}\label{bytecode-builder_8h_source}\index{src/codegen/bytecode-\/builder.h@{src/codegen/bytecode-\/builder.h}}
\mbox{\hyperlink{bytecode-builder_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ This\ file\ is\ a\ part\ of\ the\ via\ Programming\ Language\ project}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Copyright\ (C)\ 2024-\/2025\ XnLogical\ -\/\ Licensed\ under\ GNU\ GPL\ v3.0}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#ifndef\ VIA\_HAS\_HEADER\_COMPILER\_H}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#define\ VIA\_HAS\_HEADER\_COMPILER\_H}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}common.h"{}}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <parse/ast.h>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{visitor_8h}{codegen/visitor.h}}>}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{types_8h}{codegen/types.h}}>}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{instruction_8h}{interpreter/instruction.h}}>}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{state_8h}{interpreter/state.h}}>}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00024\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacevia}{via}}\ \{}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00032\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacecompiler__util}{compiler\_util}}\ \{}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00038\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ const\ \textcolor{keywordtype}{size\_t}\ Size,\ const\ T\ Default>}
\DoxyCodeLine{00039\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structvia_1_1compiler__util_1_1OperandsArray}{OperandsArray}}\ \{}
\DoxyCodeLine{00040\ \ \ std::array<T,\ Size>\ data;}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{structvia_1_1compiler__util_1_1OperandsArray}{OperandsArray}}()\ \{}
\DoxyCodeLine{00043\ \ \ \ \ data.fill(Default);}
\DoxyCodeLine{00044\ \ \ \}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{structvia_1_1compiler__util_1_1OperandsArray}{OperandsArray}}(std::initializer\_list<T>\ init)\ \{}
\DoxyCodeLine{00047\ \ \ \ \ data.fill(Default);}
\DoxyCodeLine{00048\ \ \ \ \ std::copy(init.begin(),\ init.end(),\ data.begin());}
\DoxyCodeLine{00049\ \ \ \}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \textcolor{keyword}{operator}\ std::array<T,\ Size>\&()\ \{}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordflow}{return}\ data;}
\DoxyCodeLine{00053\ \ \ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \textcolor{keyword}{operator}\ \textcolor{keyword}{const}\ std::array<T,\ Size>\&()\ \textcolor{keyword}{const}\ \{}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keywordflow}{return}\ data;}
\DoxyCodeLine{00057\ \ \ \}}
\DoxyCodeLine{00058\ \};}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00067\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bytecode-builder_8cpp_af27fc4468b84dff327faecf6c2b62095}{compiler\_error}}(\mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx,\ \textcolor{keywordtype}{size\_t}\ begin,\ \textcolor{keywordtype}{size\_t}\ end,\ \textcolor{keyword}{const}\ std::string\&\ message);}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00075\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bytecode-builder_8cpp_af27fc4468b84dff327faecf6c2b62095}{compiler\_error}}(\mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structvia_1_1Token}{Token}}\&\ token,\ \textcolor{keyword}{const}\ std::string\&\ message);}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00082\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bytecode-builder_8cpp_af27fc4468b84dff327faecf6c2b62095}{compiler\_error}}(\mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx,\ \textcolor{keyword}{const}\ std::string\&\ message);}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00091\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bytecode-builder_8cpp_adf42809064fd8620bc70f1076d94f8b7}{compiler\_warning}}(\mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx,\ \textcolor{keywordtype}{size\_t}\ begin,\ \textcolor{keywordtype}{size\_t}\ end,\ \textcolor{keyword}{const}\ std::string\&);}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00099\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bytecode-builder_8cpp_adf42809064fd8620bc70f1076d94f8b7}{compiler\_warning}}(\mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structvia_1_1Token}{Token}}\&,\ \textcolor{keyword}{const}\ std::string\&);}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00106\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bytecode-builder_8cpp_adf42809064fd8620bc70f1076d94f8b7}{compiler\_warning}}(\mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx,\ \textcolor{keyword}{const}\ std::string\&);}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00115\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bytecode-builder_8cpp_a73fd43f361196186f7beec71629c8f1e}{compiler\_info}}(\mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx,\ \textcolor{keywordtype}{size\_t}\ begin,\ \textcolor{keywordtype}{size\_t}\ end,\ \textcolor{keyword}{const}\ std::string\&);}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00123\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bytecode-builder_8cpp_a73fd43f361196186f7beec71629c8f1e}{compiler\_info}}(\mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structvia_1_1Token}{Token}}\&,\ \textcolor{keyword}{const}\ std::string\&);}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00130\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bytecode-builder_8cpp_a73fd43f361196186f7beec71629c8f1e}{compiler\_info}}(\mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx,\ \textcolor{keyword}{const}\ std::string\&);}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00136\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bytecode-builder_8cpp_ad6a1180fc963b94b13e5513905590593}{compiler\_output\_end}}(\mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx);}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00143\ \mbox{\hyperlink{structvia_1_1StackFunction}{StackFunction}}\&\ \mbox{\hyperlink{bytecode-builder_8cpp_a8da7ee9839b6bf66721300862d71a126}{get\_current\_closure}}(\mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx);}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00150\ \mbox{\hyperlink{structvia_1_1Value}{Value}}\ \mbox{\hyperlink{bytecode-builder_8cpp_a405bea795e2517d90b3f2155bbb7610a}{construct\_constant}}(\mbox{\hyperlink{structvia_1_1LitExprNode}{LitExprNode}}\&\ constant);}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00159\ \mbox{\hyperlink{structvia_1_1LitExprNode}{LitExprNode}}\ \mbox{\hyperlink{bytecode-builder_8cpp_ac9703f204266ee5ff6611665067a580c}{fold\_constant}}(\mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx,\ \mbox{\hyperlink{structvia_1_1ExprNodeBase}{ExprNodeBase}}*\ constant,\ \textcolor{keywordtype}{size\_t}\ fold\_depth\ =\ 0);}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00167\ \mbox{\hyperlink{namespacevia_a90951ca238c08fe5449c13c9ed3cc38e}{operand\_t}}\ \mbox{\hyperlink{bytecode-builder_8cpp_a821ac9cae97689669d2c96e6d1411d28}{push\_constant}}(\mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx,\ \mbox{\hyperlink{structvia_1_1Value}{Value}}\&\&\ constant);}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00176\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bytecode-builder_8cpp_ae336781c36f310148a11623a10fd6761}{resolve\_lvalue}}(\mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx,\ \mbox{\hyperlink{structvia_1_1ExprNodeBase}{ExprNodeBase}}*\ lvalue,\ \mbox{\hyperlink{namespacevia_a90951ca238c08fe5449c13c9ed3cc38e}{operand\_t}}\ dst);}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00185\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bytecode-builder_8cpp_aa83c6cf545d9a79002c7088f35f7ec31}{resolve\_rvalue}}(\mbox{\hyperlink{classvia_1_1NodeVisitorBase}{NodeVisitorBase}}*\ visitor,\ \mbox{\hyperlink{structvia_1_1ExprNodeBase}{ExprNodeBase}}*\ rvalue,\ \mbox{\hyperlink{namespacevia_a90951ca238c08fe5449c13c9ed3cc38e}{operand\_t}}\ dst);}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00194\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bytecode-builder_8cpp_a69030828d339302cc913315f7a911490}{bind\_lvalue}}(\mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx,\ \mbox{\hyperlink{structvia_1_1ExprNodeBase}{ExprNodeBase}}*\ lvalue,\ \mbox{\hyperlink{namespacevia_a90951ca238c08fe5449c13c9ed3cc38e}{operand\_t}}\ src);}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00203\ \mbox{\hyperlink{structvia_1_1TypeNodeBase}{TypeNodeBase}}*\ \mbox{\hyperlink{bytecode-builder_8cpp_add415b7aca65d8e5f933f440968a0533}{resolve\_type}}(\mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx,\ \mbox{\hyperlink{structvia_1_1ExprNodeBase}{ExprNodeBase}}*\ expr);}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00209\ \textcolor{keyword}{using\ }\mbox{\hyperlink{structvia_1_1compiler__util_1_1OperandsArray}{operands\_init\_t}}\ =\ \mbox{\hyperlink{structvia_1_1compiler__util_1_1OperandsArray}{OperandsArray<operand\_t,\ 3,\ OPERAND\_INVALID>}};}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00218\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bytecode-builder_8cpp_a7da6a7e98da441aeb6cce0b329a15cb1}{bytecode\_emit}}(}
\DoxyCodeLine{00219\ \ \ \mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx,}
\DoxyCodeLine{00220\ \ \ \mbox{\hyperlink{namespacevia_ac8974a71c8a4b5a87cbb4ea665ebfd62}{Opcode}}\ opcode\ =\ \mbox{\hyperlink{namespacevia_ac8974a71c8a4b5a87cbb4ea665ebfd62a1a004f5abe2b334db21328be1ea6b593}{Opcode::NOP}},}
\DoxyCodeLine{00221\ \ \ \mbox{\hyperlink{structvia_1_1compiler__util_1_1OperandsArray}{operands\_init\_t}}\&\&\ operands\ =\ \{\},}
\DoxyCodeLine{00222\ \ \ std::string\ comment\ =\ \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{00223\ );}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00230\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bytecode-builder_8cpp_a7bce3ee1324627943bb8a7dae03f82ce}{close\_defer\_statements}}(\mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx,\ \mbox{\hyperlink{classvia_1_1NodeVisitorBase}{NodeVisitorBase}}*\ visitor);}
\DoxyCodeLine{00231\ }
\DoxyCodeLine{00237\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{namespacevia_a90951ca238c08fe5449c13c9ed3cc38e}{operand\_t}}\ \mbox{\hyperlink{bytecode-builder_8h_a1a769bd32cb52620f99848cfe93fae0c}{alloc\_register}}(\mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx)\ \{}
\DoxyCodeLine{00238\ \ \ \textcolor{keywordflow}{return}\ ctx.\mbox{\hyperlink{structvia_1_1VisitorContext_a3f2713ae46030f92aaa3856377cd3afa}{reg\_alloc}}.\mbox{\hyperlink{classvia_1_1RegisterAllocator_a9520ef0cef2944106fd8de1920db18e8}{allocate\_register}}();}
\DoxyCodeLine{00239\ \}}
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00247\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bytecode-builder_8h_af77668addbda8eb247ec34282720901c}{free\_register}}(\mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\&\ ctx,\ \mbox{\hyperlink{namespacevia_a90951ca238c08fe5449c13c9ed3cc38e}{operand\_t}}\ reg)\ \{}
\DoxyCodeLine{00248\ \ \ ctx.\mbox{\hyperlink{structvia_1_1VisitorContext_a3f2713ae46030f92aaa3856377cd3afa}{reg\_alloc}}.\mbox{\hyperlink{classvia_1_1RegisterAllocator_a803062b7bafc00fb5d1afe1160e4fb00}{free\_register}}(reg);}
\DoxyCodeLine{00249\ \}}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00251\ \}\ \textcolor{comment}{//\ namespace\ compiler\_util}}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00259\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classvia_1_1BytecodeBuilder}{BytecodeBuilder}}\ final\ \{}
\DoxyCodeLine{00260\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00261\ \ \ \mbox{\hyperlink{classvia_1_1BytecodeBuilder}{BytecodeBuilder}}(\mbox{\hyperlink{classvia_1_1TransUnitContext}{TransUnitContext}}\&\ unit\_ctx)}
\DoxyCodeLine{00262\ \ \ \ \ :\ ctx(unit\_ctx)\ \{\}}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00268\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classvia_1_1BytecodeBuilder_ae47deccecfdd87d4f1af4ee7fab3830f}{generate}}();}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00274\ \ \ \textcolor{keywordtype}{void}\ codegen\_prep();}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00279\ \ \ \textcolor{keywordtype}{void}\ insert\_exit0\_instruction();}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00282\ \ \ \mbox{\hyperlink{structvia_1_1VisitorContext}{VisitorContext}}\ ctx;}
\DoxyCodeLine{00283\ \};}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \}\ \textcolor{comment}{//\ namespace\ via}}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00289\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
